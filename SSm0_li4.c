/*

  Implementation of the Re[Li4(x)] function for real argument.

  Based on the code provided with the paper
  by Hjalte Frellesvig, Damiano Tommasini, and Christopher Wever [ArXiv:1601.02649]

*/

#include "SSm0_internal.h"

static const double WTFccli4logA0[100] =
  {
    1.,
    -0.4375,
    0.116512345679012345679,
    -0.0198206018518518518519,
    0.00192793209876543209877,
    -0.0000310570987654320987654,
    -0.0000156240091148578352984,
    8.48512354677320663715e-7,
    2.29096166031897114454e-7,
    -2.18326142185269169396e-8,
    -3.88282487917201557228e-9,
    5.44629210322033211826e-10,
    6.96080521068272540788e-11,
    -1.33757376864452151996e-11,
    -1.27848526852665716041e-12,
    3.26056285802489224288e-13,
    2.36475711686182573623e-14,
    -7.92313512203116170243e-15,
    -4.34529157099841872505e-16,
    1.92362700625359201161e-16,
    7.81241433319595467072e-18,
    -4.67180384480365552032e-18,
    -1.34353443298128478563e-19,
    1.13568268513473432448e-19,
    2.11527562024325868475e-21,
    -2.76420263347465173883e-21,
    -2.70681766082400642561e-23,
    6.73720448286285721433e-23,
    1.32872654566838229758e-25,
    -1.64437730563678264678e-24,
    8.28360589993393411098e-27,
    4.01908484950693506997e-26,
    -4.57571384448487903824e-28,
    -9.83641090946151277583e-28,
    1.69003395560378510677e-29,
    2.41048055630598085047e-29,
    -5.42661270567141825013e-31,
    -5.91424295887417678643e-31,
    1.62321109010873707727e-32,
    1.45275954377402759461e-32,
    -4.65389937002573704417e-34,
    -3.57238626244413318155e-34,
    1.29761714880310295826e-35,
    8.79357407773938851104e-36,
    -3.54800202048240308912e-37,
    -2.16664890557524341907e-37,
    9.56297460946282350704e-39,
    5.34322126093722654955e-39,
    -2.54963437789177480886e-40,
    -1.31882249182120724067e-40,
    6.74037400668154401788e-42,
    3.25774281002835543887e-42,
    -1.76996386256552780178e-43,
    -8.0533161432244997741e-44,
    4.62250636973489251082e-45,
    1.99224110969544847858e-45,
    -1.20184180204010726741e-46,
    -4.93175263358610787137e-47,
    3.11316477540073386702e-48,
    1.22162300023669984991e-48,
    -8.038973030018921484e-50,
    -3.0278550570553808811e-50,
    2.07037700828217960464e-51,
    7.50898813847745429979e-52,
    -5.32005434785139596661e-53,
    -1.86321798030729142091e-53,
    1.36438674086913892954e-54,
    4.62562228479100128625e-55,
    -3.49322850967750355194e-56,
    -1.14892073763547810912e-56,
    8.93056838063858868517e-58,
    2.85504700822500006532e-58,
    -2.28020178171680062863e-59,
    -7.09790728946794639746e-60,
    5.81536334491194965716e-61,
    1.76535657835283981573e-61,
    -1.48165542113083171025e-62,
    -4.39249608642942180811e-63,
    3.77166909800052009728e-64,
    1.09335058985186147316e-64,
    -9.59352943193532309929e-66,
    -2.72250945730634009726e-66,
    2.43847604741885803322e-67,
    6.78163582968617819584e-68,
    -6.1942091850815116331e-69,
    -1.68985047448267491796e-69,
    1.57256481187918205893e-70,
    4.21215988254282308793e-71,
    -3.99035150254708964398e-72,
    -1.05026413184243135216e-72,
    1.01208118319796523577e-73,
    2.61953389281739242032e-74,
    -2.56590350424304856471e-75,
    -6.53546204079948148134e-76,
    6.50284010381767327271e-77,
    1.63098745669846195996e-77,
    -1.64747471701345956914e-78,
    -4.07138823579912582133e-79,
    4.1725435897486877128e-80,
    1.01659448158098681216e-80
  };

static const double WTFccli4logA1[100] =
  {
    -1.2020569031595942854,
    -0.30555555555555555556,
    0.00069444444444444444444,
    -1.6534391534391534392e-6,
    1.0935444136502337561e-8,
    -1.043837849393404949e-10,
    1.2165942300622435303e-12,
    -1.6130006528350101297e-14,
    2.3428810452879339693e-16,
    -3.6438771675294363464e-18,
    5.9774868116665584546e-20,
    -1.023371305551506622e-21,
    1.8145595613834748074e-23,
    -3.3130258038491270989e-25,
    6.2009793265361940404e-27,
    -1.185645085417334982e-28,
    2.3093357489590288574e-30,
    -4.5715484696271027862e-32,
    9.1804355339469610484e-34,
    -1.8672493042968627424e-35,
    3.8415186535561060663e-37,
    -7.9849769592571845021e-39,
    1.6752999995755266689e-40,
    -3.5448258824794902347e-42,
    7.5589773528191572591e-44,
    -1.6233748620526028804e-45,
    3.5092732351527945546e-47,
    -7.6320495005946544462e-49,
    1.6691592454035883372e-50,
    -3.669564111503312607e-52,
    8.1065588585986180002e-54,
    -1.7989726875577937753e-55,
    4.0091526074492244006e-57,
    -8.9702872802163377578e-59,
    2.0145680516561364566e-60,
    -4.5403000559636200709e-62,
    1.0266619470478773195e-63,
    -2.3287943255266983454e-65,
    5.2981278801061021428e-67,
    -1.208743047245030631e-68,
    2.7650536601483872557e-70,
    -6.3412310338420858393e-72,
    1.4577754555173903646e-73,
    -3.3589623654927270203e-75,
    7.7565917541751140891e-77,
    -1.7949195985010700618e-78,
    4.1618571135913038836e-80,
    -9.668517150295945718e-82,
    2.2502353544990477028e-83,
    -5.2463637153517158903e-85,
    1.2252374210231744113e-86,
    -2.866054137394654618e-88,
    6.7146501272821480982e-90,
    -1.5754745974069950638e-91,
    3.7018946334612182958e-93,
    -8.7104039396442925562e-95,
    2.052259837693086083e-96,
    -4.8415629364962849972e-98,
    1.1436113584942495974e-99,
    -2.7045340056875990377e-101,
    6.4033898658949691881e-103,
    -1.5177989016400286756e-104,
    3.6015497285168045913e-106,
    -8.5550067199249842541e-108,
    2.0341952530628894015e-109,
    -4.8416402626848330638e-111,
    1.1534715545581374011e-112,
    -2.7505733659360582534e-114,
    6.5649223451007144886e-116,
    -1.5682472576750025402e-117,
    3.7494462075355673366e-119,
    -8.9717444633549515704e-121,
    2.1484923548251578117e-122,
    -5.1490637312573557089e-124,
    1.23495473903605997e-125,
    -2.9641029834971133757e-127,
    7.1194511888839523558e-129,
    -1.7112070761820885189e-130,
    4.1157937064434091258e-132,
    -9.9058573535679360969e-134,
    2.3856719545639749229e-135,
    -5.7491359789701891112e-137,
    1.3863117698730464134e-138,
    -3.3448699238932379129e-140,
    8.0751630969015281485e-142,
    -1.9506129061942392234e-143,
    4.7144690933483656373e-145,
    -1.1400680924408716029e-146,
    2.7584154090594095047e-148,
    -6.6775046199981985271e-150,
    1.6172952635253489632e-151,
    -3.9190439466387305192e-153,
    9.5012758114396810026e-155,
    -2.3045711222952803411e-156,
    5.592426395586265426e-158,
    -1.3577134575014580948e-159,
    3.2976875278145225034e-161,
    -8.0130968508266786688e-163,
    1.9479459191172635013e-164,
    -4.7373473959463380816e-166
  };

static const double WTFccli4inv0 = -1.8940656589944918352;
static const double WTFccli4inv2 = -0.82246703342411321824;
static const double WTFccli4inv4 = -0.041666666666666666667;

static const double WTFccli4inone = 1.08232323371113819152;

static const double WTFccli4logA10 =  1.0823232337111381915;
static const double WTFccli4logA12 =  0.82246703342411321824;
static const double WTFccli4logA14 =  -0.020833333333333333333;
static const double WTFccli4logA1log =  0.16666666666666666667;

double SSm0_li4logA0rec(double next, int nc, double x)
{
  if (nc < li_constants.LINLOGA0MAX)
    return next*WTFccli4logA0[nc] + SSm0_li4logA0rec(next*x, nc+1, x);
  else
    return next*WTFccli4logA0[nc];
}

double SSm0_li4logA0(double x)
{
  double mlog = -log(1.0-x);
  return mlog + SSm0_li4logA0rec(mlog*mlog, 1, mlog);
}

double SSm0_li4logA1rec(double next, int nc, double xsq)
{
  if (nc < li_constants.LINLOGA1MAX)
    return WTFccli4logA1[nc]*next + SSm0_li4logA1rec(next*xsq, nc+1, xsq);
  else
    return WTFccli4logA1[nc]*next;
}

double SSm0_li4logA1(double a)
{
  double x = -log(a);
  double xsq = x*x;
  return WTFccli4logA10 + xsq*(WTFccli4logA12 + xsq*WTFccli4logA14 + x*WTFccli4logA1log*log(x)) + SSm0_li4logA1rec(x, 0, xsq);
}

/* REAL version */
double SSm0_li4inv(double x)
{
  double ix = 1.0/x;
  if ( x > 0)
    {
      double logx2 = log(x)*log(x);
      double lsq = logx2 - li_constants.Pi2;
      double lsq2 = li_constants.Pi4 - 6*li_constants.Pi2*logx2 + logx2*logx2;
      return -SSm0_li4logA0(ix) + WTFccli4inv0 + lsq*WTFccli4inv2 + lsq2*WTFccli4inv4;
    }
  else
    {
      double logmx = log(-x);
      double lsq = logmx*logmx;
      return -SSm0_li4logA0(ix) + WTFccli4inv0 + lsq*(WTFccli4inv2 + lsq*WTFccli4inv4);
    }
}

/* Explicitly real PolyLog[4,x] */
double li4re(double x)
{
  if (x < 0.5)
    {
      if (fabs(x) < 1.0)
        return SSm0_li4logA0(x);
      else
        return SSm0_li4inv(x);
    }
  if (fabs(x-1.0) < 1.0)
    {
      if (x == 1.0)
        return WTFccli4inone;
      else
        return SSm0_li4logA1(x);
    }
  else
    return SSm0_li4inv(x);
}

